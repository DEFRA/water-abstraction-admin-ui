{{> styles}}
<main id="content">
  {{>element-phase-tag}}
  <nav>
    <div class="breadcrumbs">
      <ol>
        <li><a href="/">Your services</a></li>
        <li><a href="/admin">admin</a></li>
        <li><a href="/admin/idm">idm</a></li>
        <li><a href="/admin/idm/users">users</a></li>
        <li><a href="/admin/idm/users/{{user_id}}">{{user_id}}</a></li>
      </ol>
    </div>
  </nav>
  <div class="grid-row">
    <div class="column-full">
      <h1 class="heading-xlarge">
        Permit Repository Admin
      </h1>
      <h1 class="heading-large">
      View User
      </h1>
      <table>
<tr><td>User ID</td><td>{{user.user_id}}</td></tr>
<tr><td>Email</td><td>{{user.user_name}}</tr>
<tr><td>Is Admin</td><td>{{user.admin}}</tr>
<tr><td>Metadata</td><td>{{user.user_data}}</tr>
<tr><td>Reset GUID</td><td>{{user.reset_guid}}</tr>
<tr><td>Reset required</td><td>{{user.reset_required}}</tr>
<tr><td>Last Login</td><td>{{user.last_login}}</tr>
<tr><td>Bad Logins</td><td>{{user.bad_logins}}</tr>
<tr><td>Reset Password to:</td><td><input id="newpassword"><button onclick="updatePassword()">RESET</button></td></tr>
<!--- /admin/idm/updatePassword/{user_name} --->
</table>


    </div>
  </div>
</main>
{{> footerjs}} {{> debug}}


<script language="javascript">
  $("#licencesearch").bind("keyup change", doFind);

  function doFind() {
    var val = $('#licencesearch').val()
    console.log(val)
    url = '/admin/findlicence/' + val
    $.ajax({
      url: url,
      success: function(res, err) {
        var html = '<table>';
        for (r in res.data) {
          if (res.data[r]) {
            html += `<tr><td><a href="/admin/licence/${res.data[r].licence_id}">${res.data[r].licence_id}</a></td><td>${res.data[r].licence_ref}</td><td>${res.data[r].licence_search_key}<br>`;
          }

        }
        html += '</table>'
        $("#results").html(html)
        console.log(err)
      }
    });

  }

function updatePassword(){
  var URI="/admin/idm/updatePassword/{{user.user_name}}"
  var data={password:$("#newpassword").val()};
  console.log(URI)
  console.log(data)

  $.ajax({
    type: "POST",
    url: URI,
    data: data,
    success: function(res,err){
      console.log(err)
      console.log(res)
      location.reload()
    },
    dataType: 'json'
  });

}
</script>
