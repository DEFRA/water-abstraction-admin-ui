{{> styles}}
<main id="content">
  {{>element-phase-tag}}
  <nav>
    <div class="breadcrumbs">
      <ol>
        
        <li><a href="/admin">admin</a></li>
        <li><a href="/admin/findlicence">find licence</a></li>
        <li><a href="/{{licence_id}}">{{licence_id}}</a></li>
      </ol>
    </div>
  </nav>
  <div class="grid-row">
    <div class="column-full">
      <h1 class="heading-xlarge">
        Permit Repository Admin
      </h1>
      <h1 class="heading-large">
      View licence
      </h1>
      <h1 class="heading-medium">
      Shortcodes
      </h1>
      Shortcodes enable licence users to register to view a licence using the provided shortcode. A shortcode can only be used once.


<br>
<a class="button" href='/admin/licence/{{licence_id}}/addshortcode'>Add Shortcode</a>
<br><br>
      <h1 class="heading-small">
Unused Shortcodes
</h1>
The following shortcodes can be given to users for registration:
<table>
  <tr><th>&nbsp;</th><th>Code</th><th>Expires</th></tr>
        {{#each shortCodes.data}}
<tr>
  <td>{{shortcode_id}}</td>
  <td>{{shortcode}}</td>
  <td>{{expiry_dt}}</td>



</tr>
        {{/each}}
</table>
<h1 class="heading-small">
Assigned Users
</h1>
The following users can access this licence


<table>
        {{#each users.data}}
<tr>
  <td><a href="/admin/users/{{user_id}}">{{user_id}}</a></td>



</tr>
        {{/each}}
</table>

    </div>
  </div>
</main>
{{> footerjs}}
{{> debug}}


      <script language="javascript">
      $("#licencesearch").bind("keyup change", doFind);

      function doFind(){
        var val=$('#licencesearch').val()
        console.log(val)
        url='/admin/findlicence/'+val
        $.ajax({
    url: url,
    success: function(res,err){
      var html='<table>';
      for(r in res.data){
        if(res.data[r]){
        html+=`<tr><td><a href="/admin/licence/${res.data[r].licence_id}">${res.data[r].licence_id}</a></td><td>${res.data[r].licence_ref}</td><td>${res.data[r].licence_search_key}<br>`;
        }

      }
      html+='</table>'
      $("#results").html(html)
      console.log(err)
    }
  });

      }

</script>
